<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0025)http://nemerle.org/About/ -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>
	First Tutorial
</title>
    <link type="text/css" rel="stylesheet" href="static/style.css">
    <link type="text/css" rel="stylesheet" href="static/theme-default.css">
    <link type="text/css" rel="stylesheet" href="static/pygments.css">
<body>
        <table border="0" cellpadding="0" cellspacing="0">
            <tbody><tr class="header">
                <td>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody><tr>
                            <td width="100px"></td>
                            <td>
                                <table border="0" cellpadding="0" cellspacing="0">
                                    <tbody><tr>
                                        <td width="110px"></td>
                                        <td width="170px">
                                            <a href="./static/About - Nemerle programming language official site.htm"><img src="./static/logo.png"></a>
                                        </td>
                                        <td width="31px">
                                            <a href="./static/About - Nemerle programming language official site.htm"><img src="./static/ribbon.png"></a>
                                        </td>
                                        <td align="right" valign="bottom">
                                            <table border="0" cellpadding="0" cellspacing="0" class="menubar">
                                                <tbody><tr height="36">
                                                    <td class="menuitem">
                                                        <a href="http://nemerle.org/About/#"><img src="./static/menuitem-about-active-foreground.png"></a>
                                                    </td>
                                                    <td class="menuitem">
                                                        <a href="http://nemerle.org/wiki/index.php?title=Main_Page"><img src="./static/menuitem-wiki-inactive-foreground.png"></a>
                                                    </td>
                                                    <td class="menuitem">
                                                        <a href="http://groups.google.com/group/nemerle-en"><img src="./static/menuitem-forum-inactive-foreground.png"></a>
                                                    </td>
                                                    <td class="menuitem">
                                                        <a href="http://code.google.com/p/nemerle/downloads/list"><img src="./static/menuitem-downloads-inactive-foreground.png"></a>
                                                    </td>
                                                    <td>
                                                        <a href=""><img src="./static/menuitem-search-inactive-foreground.png"></a>
                                                    </td>
                                                </tr>
                                                <tr height="8">
                                                    <td colspan="4"></td>
                                                </tr>
                                            </tbody></table>
                                        </td>
                                    </tr>
                                </tbody></table>
                            </td>
                            <td width="100px">
                            </td>
                        </tr>
                    </tbody></table>
                </td>
            </tr>
            <tr class="body">
                <td>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody><tr>
                            <td width="100px">
                                &nbsp;
                            </td>
                            <td class="content">
                                <div>
                                    
<div align="right">
</div>

<p>
</p><table id="toc" class="toc" summary="Contents"><tr><td><div>Table of Contents</div><ul><li><a href="#Introduction">Introduction</a><ul><li><a href="#Nemerle_NET_and_Mono">Nemerle, .NET, and Mono</a></li><li><a href="#Getting_Started">Getting Started</a></li></ul></li><li><a href="#Simple_Examples">Simple Examples</a><ul><li><a href="#Hello_World">Hello World</a><ul><li><a href="#Classes_a_First_Look">Classes: a First Look</a></li></ul></li><li><a href="#The_Adder">The Adder</a></li><li><a href="#Counting_Lines_in_a_File">Counting Lines in a File</a></li></ul></li><li><a href="#Functional_examples">Functional examples</a><ul><li><a href="#Functional_Programming_a_First_Look">Functional Programming: a First Look</a></li></ul></li><li><a href="#Rewriting_Line_Counter_without_the_loop">Rewriting Line Counter without the loop</a></li><li><a href="#Rewriting_line_counter_without_mutable_values">Rewriting line counter without mutable values</a></li><li><a href="#Type_inference">Type inference</a></li></ul></td></tr></table><h2><span class="mw-headline" id="Introduction"><a name="Introduction" id="Introduction">Introduction</a></span></h2>

<p>This tutorial describes the basics of programming in Nemerle. It is also a &#xD;
quick tour of some of the features and programming concepts that distinguish Nemerle &#xD;
from other languages.&#xD;</p>

<p>We assume the reader is familiar with C#, Java or C++. But even if you are new to &#xD;
programming, you should find the code easy to understand.&#xD;</p>

<h3><span class="mw-headline" id="Nemerle_NET_and_Mono"><a name="Nemerle_NET_and_Mono" id="Nemerle_NET_and_Mono">Nemerle, .NET, and Mono</a></span></h3>

<p>Nemerle is a <span title="Say &amp;lsquo;dot-NET&amp;rsquo;"><i>.NET</i></span> &#xD;
compatible language. As such, it relies heavily on the &#xD;
<a target="_blank" href="http://msdn.microsoft.com/netframework/programming/">.NET Framework</a>, &#xD;
which not only defines how critical parts of all .NET languages work, &#xD;
but also provides these services:&#xD;</p>

<ul><li> A runtime environment, called the Common Language Runtime (CLR), which is shared among all .NET languages. This is similar to the Java VM &#xD;
</li><li> A set of libraries, called the Base Class Libraries (BCL), which contain thousands of functions that perform a wide range of services required by programs &#xD;
</li></ul> &#xD;
The BCL and CLR ensure that programs written in any .NET language can be &#xD;
easily used in any other .NET language. These features of language neutrality &#xD;
and interoperability make .NET an attractive platform for development.&#xD;

<p>Further, Nemerle is compatible with <a target="_blank" href="http://www.mono-project.com/Main_Page">Mono</a>, &#xD;
an open-source implementation of the published .NET <i>Common Language Infrastructure (CLI)</i> &#xD;
standard. This opens up the exciting possibility of writing .NET programs &#xD;
that not only work across different languages, but span different &#xD;
operating systems. With Mono, you can design programs that run on Linux, &#xD;
Mac&#xA0;OS&#xA0;X, and the BSD&#xA0;Unix flavors, as well as Windows.&#xD;</p>

<p>So, while Nemerle is defined (and constrained) in part by the .NET Framework, &#xD;
it is very much its own language. It offers a unique combination of features &#xD;
not found in other .NET languages, which give it advantages of conciseness and &#xD;
flexibility that should prove attractive to a wide range of programmers, from &#xD;
students to seasoned developers.&#xD;</p>

<h3><span class="mw-headline" id="Getting_Started"><a name="Getting_Started" id="Getting_Started">Getting Started</a></span></h3>

<p>To run the examples in this tutorial, you will need to <a class="internal absent" href="/install-Nemerle.html">Step_by_step_guide_to_get_Nemerle_compiler_running</a>. Hacker types will want to <a class="internal present" href="/Download.html">Download</a> the source.&#xD;</p>

<h2><span class="mw-headline" id="Simple_Examples"><a name="Simple_Examples" id="Simple_Examples">Simple Examples</a></span></h2>

<p>This section lists simple examples that look almost the same in C#&#xD;
(or Java, or C++).&#xD;</p>

<h3><span class="mw-headline" id="Hello_World"><a name="Hello_World" id="Hello_World">Hello World</a></span></h3>

<p>We start with a classic first example:&#xD;</p>

<div class="highlight"><pre><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="s">"Hello world!"</span><span class="p">);</span>
</pre>
</div>


<p>To run this example:&#xD;</p>

<ul><li> Write it with your favorite text editor and save it as <code>hello.n</code>&#xD;
</li><li> Get to the console by running cmd in Windows, or the terminal window in Linux/BSD&#xD;
</li><li> Run the Nemerle compiler by typing <code>ncc hello.n</code>&#xD;
</li><li> The output goes to <code>out.exe</code>&#xD;
</li><li> Run it by typing <code>out</code> or <code>mono out.exe</code> depending on your OS &#xD;
</li></ul> &#xD;
Observe how an individual code statement ends with a semi-colon<code>;</code>&#xD;

<p>This program writes "Hello world!" to the console. It does this by calling <code>System.Console.WriteLine</code>, a function in the .NET Framework. &#xD;</p>

<p>As this example shows, you can write a bunch of statements in a file (separated by semi-colons), and Nemerle will execute them. However, this example really isn't a proper, stand-alone program. To make it one, you need to wrap it in a class.&#xD;</p>

<h4><span class="mw-headline" id="Classes_a_First_Look"><a name="Classes_a_First_Look" id="Classes_a_First_Look">Classes: a First Look</a></span></h4>

<p>Lets expand our example to include a class. Enter these lines in your <code>hello.n</code> file: &#xD;</p>

<div class="highlight"><pre> <span class="k">class</span> <span class="nc">Hello</span>
 <span class="p">{</span>
   <span class="k">static</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">void</span>
   <span class="p">{</span>
     <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="s">"Hello world!"</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre>
</div>


<p>Notice how blocks of code are grouped together using curly braces <code>{&amp;nbsp;}</code>, typical of C-style programs.&#xD;</p>

<p>When you compile and run this program, you get the same results as before. So why the extra lines? The answer is that Nemerle, like most .NET languages, is object-oriented:&#xD;
</p><ul><li> <code>class Hello</code> simply means that you are defining a <i>class</i>, or type of object, named <code>Hello</code>. A class is a template for making objects. Classes can be used standalone, too, as is the case here.&#xD;
</li><li> <code>static Main</code> defines a function <code>Main</code>, which belongs to class <code>Hello</code>. A function that belongs to a class is called a <i>method</i> of the class. So, here you would say "function <code>Main</code> is a method of class <code>Hello</code>." &#xD;
</li><li> By convention, program execution starts at <code>static Main</code>. The keyword <code>static</code> means the method can be called directly, without first creating an object of type <code>Hello</code>. Static methods are the equivalent of public or module-level functions in non-object languages.&#xD;
</li></ul> &#xD;
This example is much closer to what a C# programmer would write. The only difference is that in Nemerle we write the method's return type on the right, after the colon. So, <code>static&amp;nbsp;Main():void</code> specifies that method <code>Main</code> returns <code>void</code>, or no usable type. This is the equivalent of a subroutine in Basic.&#xD;

<h3><span class="mw-headline" id="The_Adder"><a name="The_Adder" id="The_Adder">The Adder</a></span></h3>

<p>Adder is a very simple program that reads and adds two numbers. We will &#xD;
refine this program by introducing several Nemerle concepts. &#xD;</p>

<p>To start, enter and compile this code:&#xD;</p>

<div class="highlight"><pre> <span class="cm">/*  Our second example.  </span>
<span class="cm">    This is a comment. */</span> 

 <span class="k">using</span> <span class="n">System</span><span class="p">;</span>

 <span class="c1">//  This is also a comment</span>
 
 <span class="k">public</span> <span class="k">class</span> <span class="nc">Adder</span>      <span class="c1">//  As in C#, we can mark classes public.</span>
 <span class="p">{</span>
   <span class="k">public</span> <span class="k">static</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">void</span>         <span class="c1">//  Methods, too.</span>
   <span class="p">{</span>
     <span class="cm">/*  Read two lines, convert them to integers and return their</span>
<span class="cm">       sum. */</span> 
     <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="s">"The sum is {0}"</span><span class="p">,</span>
                        <span class="c1">//  System.Int32.Parse converts string into integer.</span>
                        <span class="n">Int32</span><span class="p">.</span><span class="n">Parse</span> <span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span> <span class="p">())</span> <span class="p">+</span>
                        <span class="n">Int32</span><span class="p">.</span><span class="n">Parse</span> <span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span> <span class="p">()));</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre>
</div>


<p>When run, Adder lets you type in two numbers from the console, then prints out the sum.&#xD;</p>

<p>As you can see, a lengthy statement can be continued on multiple lines, and mixed with &#xD;
comments, as long as it ends with a semi-colon<code>;</code>&#xD;</p>

<p>The <code>using</code> declaration imports identifiers from the specified namespace, so they &#xD;
can be used without a prefix. This improves readability and saves typing. Unlike C#, &#xD;
Nemerle can also import members from classes, not only from namespaces. For example:&#xD;</p>

<div class="highlight"><pre> <span class="k">using</span> <span class="n">System</span><span class="p">;</span>
 <span class="k">using</span> <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">;</span>

 <span class="k">public</span> <span class="k">class</span> <span class="nc">Adder</span>
 <span class="p">{</span>
   <span class="k">public</span> <span class="k">static</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">void</span>
   <span class="p">{</span>
     <span class="n">WriteLine</span> <span class="p">(</span><span class="s">"The sum is {0}"</span><span class="p">,</span>
                <span class="n">Int32</span><span class="p">.</span><span class="n">Parse</span> <span class="p">(</span><span class="n">ReadLine</span> <span class="p">())</span> <span class="p">+</span>
                <span class="n">Int32</span><span class="p">.</span><span class="n">Parse</span> <span class="p">(</span><span class="n">ReadLine</span> <span class="p">()));</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre>
</div>


<p>You probably noticed that the code that reads and converts the integers &#xD;
is needlessly duplicated. We can simplify and clarify this code by &#xD;
factoring it into its own method:&#xD;</p>

<div class="highlight"><pre> <span class="k">using</span> <span class="n">System</span><span class="p">;</span>

 <span class="k">public</span> <span class="k">class</span> <span class="nc">Adder</span>
 <span class="p">{</span>
   <span class="c1">//  Methods are private by default.</span>
   <span class="k">static</span> <span class="nf">ReadInteger</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">int</span>
   <span class="p">{</span>
     <span class="n">Int32</span><span class="p">.</span><span class="n">Parse</span> <span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span> <span class="p">())</span>
   <span class="p">}</span>

   <span class="k">public</span> <span class="k">static</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">void</span>
   <span class="p">{</span>
     <span class="k">def</span> <span class="n">x</span> <span class="p">=</span> <span class="n">ReadInteger</span> <span class="p">();</span> <span class="c1">//  Value definition.</span>
     <span class="k">def</span> <span class="n">y</span> <span class="p">=</span> <span class="n">ReadInteger</span> <span class="p">();</span>
     <span class="c1">//  Use standard .NET function for formatting output.</span>
     <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="s">"{0} + {1} = {2}"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="p">+</span> <span class="n">y</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre>
</div>


<p>Within the <code>Main</code> method we have defined two <i>values</i>, <code>x</code> &#xD;
and <code>y</code>. This is done using the <code>def</code> keyword. Note that we do &#xD;
not write the value type when it is defined. The compiler sees that &#xD;
<code>ReadInteger</code> returns an <code>int</code>, so therefore the type of &#xD;
<code>x</code> must also be <code>int</code>. This is called <i>type inference</i>.&#xD;</p>

<p>There is more to <code>def</code> than just declaring values: it also has an &#xD;
impact on how the value can be used, as we shall see in the next section.&#xD;</p>

<p>In this example we see no gain from using <code>def</code> instead of <code>int</code> as &#xD;
you would do in C# (both are 3 characters long :-). However <code>def</code> will save &#xD;
typing, because in most cases type names are far longer:&#xD;</p>

<div class="highlight"><pre><span class="n">FooBarQuxxFactory</span> <span class="n">fact</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FooBarQuxxFactory</span> <span class="p">();</span> <span class="c1">// C#</span>
<span class="k">def</span> <span class="n">fact</span> <span class="p">=</span> <span class="n">FooBarQuxxFactory</span> <span class="p">();</span> <span class="c1">// Nemerle</span>
</pre>
</div>


<p>When creating objects, Nemerle does not use the <code>new</code> keyword. This aligns &#xD;
nicely with the .NET concept that all types, even simple ones like <code>int</code> &#xD;
and <code>bool</code>, are objects. That being said, simple types are a special &#xD;
kind of object, and are treated differently during execution than regular objects.&#xD;</p>

<h3><span class="mw-headline" id="Counting_Lines_in_a_File"><a name="Counting_Lines_in_a_File" id="Counting_Lines_in_a_File">Counting Lines in a File</a></span></h3>

<div class="highlight"><pre> <span class="k">class</span> <span class="nc">LineCounter</span>
 <span class="p">{</span>
   <span class="k">public</span> <span class="k">static</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">void</span>
   <span class="p">{</span>
     <span class="c1">//  Open a file.</span>
     <span class="k">def</span> <span class="n">sr</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">StreamReader</span> <span class="p">(</span><span class="s">"SomeFile.txt"</span><span class="p">);</span>   <span class="c1">//  (1)</span>
     <span class="k">mutable</span> <span class="n">line_no</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>                                <span class="c1">//  (2)</span>
     <span class="k">mutable</span> <span class="n">line</span> <span class="p">=</span> <span class="n">sr</span><span class="p">.</span><span class="n">ReadLine</span> <span class="p">();</span>
     <span class="k">while</span> <span class="p">(</span><span class="n">line</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>              <span class="c1">//  (3)</span>
       <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="n">line</span><span class="p">);</span>
       <span class="n">line_no</span> <span class="p">=</span> <span class="n">line_no</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>            <span class="c1">//  (4)</span>
       <span class="n">line</span> <span class="p">=</span> <span class="n">sr</span><span class="p">.</span><span class="n">ReadLine</span> <span class="p">();</span>
     <span class="p">};</span>                                  <span class="c1">//  (5)</span>
     <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="s">"Line count: {0}"</span><span class="p">,</span> <span class="n">line_no</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre>
</div>

Several things about this example require further remarks. The first &#xD;
is the very important difference between the lines marked (1) and (2).&#xD;

<p>In line (1) we define an <i>immutable</i> variable, <code>sr</code>. Immutable means the &#xD;
value cannot be changed once it is defined. The <code>def</code> statement is used to &#xD;
mark this intent. This concept may at first seem odd, but quite often you will find &#xD;
the need for variables that don't change over their lifetime. &#xD;</p>

<p>In (2) we define a <i>mutable</i> variable, <code>line_no</code>. Mutable values are &#xD;
allowed to change freely, and are defined using the <code>mutable</code> statement. &#xD;
This is the Nemerle equivalent of a variable in C#. All variables, mutable or &#xD;
not, have to be initialized before use. &#xD;</p>

<p>In (3) we see a <code>while</code> loop. While the line is not null (end of file), &#xD;
this loop writes the line to the console, counts it, and reads the next. It works &#xD;
much like it would in C#. Nemerle also has <code>do ... while</code> loops.&#xD;</p>

<p>We see our mutable counter getting incremented in (4). The assignment operator &#xD;
in Nemerle is <code>=</code>, and is similar to C#.&#xD;</p>

<p>Lastly, in (5), we come to the end of of our while loop code block. The line count &#xD;
gets written after the while loop exits.&#xD;</p>

<h2><span class="mw-headline" id="Functional_examples"><a name="Functional_examples" id="Functional_examples">Functional examples</a></span></h2>

<p>This section introduces some of the more functional features of Nemerle. &#xD;
We will use the functional style to write some simple programs, that could &#xD;
easily be written in the more familiar imperative style, to introduce a few &#xD;
concepts of the functional approach.&#xD;</p>

<h4><span class="mw-headline" id="Functional_Programming_a_First_Look"><a name="Functional_Programming_a_First_Look" id="Functional_Programming_a_First_Look">Functional Programming: a First Look</a></span></h4>

<p>Functional programming (FP) is a style in which you do not modify the state&#xD;
of the machine with instructions, but rather evaluate functions yielding&#xD;
newer and newer values. That is, the entire program is just one big expression. In&#xD;
purely functional languages (Haskell being the main example) you cannot modify&#xD;
any objects once they are created (there is no assignment operator, like = &#xD;
in Nemerle). There are no loops, just <i>recursive functions</i>. A recursive function &#xD;
calls itself repeatedly until some end condition is met, at which time &#xD;
it returns its result.&#xD;</p>

<p>Nemerle does not force you to use FP. However you can use it whenever&#xD;
you find it necessary. Some algorithms have a very natural representation&#xD;
when written in functional style -- for example functional languages&#xD;
are very good at manipulating tree-like data structures (like XML,&#xD;
in fact XSLT can be thought of as a functional language).&#xD;</p>

<p>We will be using the terms <i>method</i> and <i>function</i> interchangeably.&#xD;</p>

<h3><span class="mw-headline" id="Rewriting_Line_Counter_without_the_loop"><a name="Rewriting_Line_Counter_without_the_loop" id="Rewriting_Line_Counter_without_the_loop">Rewriting Line Counter without the loop</a></span></h3>

<p>Let's rewrite our previous Line Counter example using a recursive function instead of the loop. It will get longer, but that will get fixed soon.&#xD;</p>

<div class="highlight"><pre> <span class="k">class</span> <span class="nc">LineCounterWithoutLoop</span>
 <span class="p">{</span>
   <span class="k">public</span> <span class="k">static</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">void</span>
   <span class="p">{</span>
     <span class="k">def</span> <span class="n">sr</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">StreamReader</span> <span class="p">(</span><span class="s">"SomeFile.txt"</span><span class="p">);</span>
     <span class="k">mutable</span> <span class="n">line_no</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

     <span class="k">def</span> <span class="nf">read_lines</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">void</span> <span class="p">{</span>            <span class="c1">//  (1)</span>
       <span class="k">def</span> <span class="n">line</span> <span class="p">=</span> <span class="n">sr</span><span class="p">.</span><span class="n">ReadLine</span> <span class="p">();</span>
       <span class="k">when</span> <span class="p">(</span><span class="n">line</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>               <span class="c1">//  (2)</span>
         <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="n">line</span><span class="p">);</span>  <span class="c1">//  (3)</span>
         <span class="n">line_no</span> <span class="p">=</span> <span class="n">line_no</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>            <span class="c1">//  (4)</span>
         <span class="n">read_lines</span> <span class="p">()</span>                     <span class="c1">//  (5)</span>
       <span class="p">}</span>
     <span class="p">};</span>

     <span class="n">read_lines</span> <span class="p">();</span>      <span class="c1">//  (6)</span>
 
     <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="s">"Line count: {0}"</span><span class="p">,</span> <span class="n">line_no</span><span class="p">);</span> <span class="c1">//  (7)</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre>
</div>


<p>In (1) we define a <i>nested method</i> called <code>read_lines</code>. This method &#xD;
simulates the <code>while</code> loop used in our previous example. It takes no &#xD;
parameters and returns a void value.&#xD;</p>

<p>(2) If line wasn't <code>null</code> (i.e. it was not the last line), (3) we write&#xD;
the line we just read, (4) increase the line number, and finally (5) call&#xD;
ourself to read rest of the lines. The when expression is explained below.&#xD;</p>

<p>Next (6) we call <code>read_lines</code> for the first time, and finally (7) print&#xD;
the line count.&#xD;</p>

<p>The <code>read_lines</code> will get called as many times as there are&#xD;
lines in the file. As you can see this is the same as the <code>while</code> loop,&#xD;
just expressed in a slightly different way. It is very important to&#xD;
grok this concept of writing loops as recursion, in order to program&#xD;
functionally in Nemerle.&#xD;</p>

<p>If you are concerned about performance of this form of writing loops --&#xD;
fear not. When a function body ends with call to another function &#xD;
no new stack frame is created. It is called a <b>tail call</b>. Thanks&#xD;
to it the example above is as efficient as the <code>while</code> loop we&#xD;
saw before.&#xD;</p>

<p>In Nemerle the if expression always need to have the else clause. It's&#xD;
done this way to avoid stupid bugs with dangling-else:&#xD;</p>

<div class="highlight"><pre><span class="c1">// C#, misleading indentation hides real code meaning</span>
<span class="k">if</span> <span class="p">(</span><span class="n">foo</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">bar</span><span class="p">)</span>
     <span class="n">m1</span> <span class="p">();</span>
<span class="k">else</span>
   <span class="nf">m2</span> <span class="p">();</span>
</pre>
</div>


<p>If you do not want the <code>else</code> clause, use <code>when</code> expression,&#xD;
as seen in the example. There is also <code>unless</code> expression, equivalent &#xD;
to <code>when</code> with the condition negated.&#xD;</p>

<h3><span class="mw-headline" id="Rewriting_line_counter_without_mutable_values"><a name="Rewriting_line_counter_without_mutable_values" id="Rewriting_line_counter_without_mutable_values">Rewriting line counter without mutable values</a></span></h3>

<p>Our previous aim of rewriting line counter removed the loop and one&#xD;
mutable value. However one mutable value has left, so we cannot say the&#xD;
example is written functionally. We will now kill it.&#xD;</p>

<div class="highlight"><pre> <span class="k">class</span> <span class="nc">FunctionalLineCounter</span>
 <span class="p">{</span>
   <span class="k">public</span> <span class="k">static</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">void</span>
   <span class="p">{</span>
     <span class="k">def</span> <span class="n">sr</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">StreamReader</span> <span class="p">(</span><span class="s">"SomeFile.txt"</span><span class="p">);</span>
     <span class="k">def</span> <span class="nf">read_lines</span> <span class="p">(</span><span class="n">line_no</span> <span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">:</span> <span class="kt">int</span> <span class="p">{</span>   <span class="c1">//  (1)</span>
       <span class="k">def</span> <span class="n">line</span> <span class="p">=</span> <span class="n">sr</span><span class="p">.</span><span class="n">ReadLine</span> <span class="p">();</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>      <span class="c1">//  (2)</span>
         <span class="n">line_no</span>              <span class="c1">//  (3)</span>
       <span class="k">else</span> <span class="p">{</span>
         <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="n">line</span><span class="p">);</span>  <span class="c1">//  (4)</span>
         <span class="n">read_lines</span> <span class="p">(</span><span class="n">line_no</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span>          <span class="c1">//  (5)</span>
       <span class="p">}</span>
     <span class="p">};</span>

     <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="p">(</span><span class="s">"Line count: {0}"</span><span class="p">,</span> <span class="n">read_lines</span> <span class="p">(</span><span class="m">0</span><span class="p">));</span> <span class="c1">//  (6)</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre>
</div>


<p>In (1) we again define a nested method called <code>read_lines</code>. However&#xD;
this time it takes one integer parameter -- the current line number. It&#xD;
returns the number of lines in the entire file.&#xD;</p>

<p>(2) If line we just read is null (that was last line), we (3) return&#xD;
the current line number as number of lines in entire file. As you can&#xD;
see <b>there is no return statement</b>. The return value of a method is its&#xD;
last expression.&#xD;</p>

<p>(4) Otherwise (it was not last line) we write the line we just read. Next (5) we call ourselves to read the next line. We need to increase the line number, since it is the next line that we will be reading. Note that as a return value from this invocation of <code>read_lines</code> we return what the next invocation of <code>read_lines</code> returned. It in turn returns what the next invocation returned and so on, until, at the end of file, we reach (3), and final line count is returned through each invocation of <code>read_lines</code>.&#xD;</p>

<p>In (6) we call the <code>read_lines</code> nested method, with initial line&#xD;
number of 0 to read the file and print out line count.&#xD;</p>

<h3><span class="mw-headline" id="Type_inference"><a name="Type_inference" id="Type_inference">Type inference</a></span></h3>

<p>We have already seen type inference used to guess types of values&#xD;
defined with <code>def</code> or <code>mutable</code>. It can be also used to&#xD;
guess type of function parameters and return type. Try removing the :&#xD;
int constraints from line marked (1) in our previous example.&#xD;</p>

<p>Type inference only works for nested functions. Type annotations are&#xD;
required in top-level methods (that is methods defined in classes, not&#xD;
in other methods). This is design decision, that is here not to change&#xD;
external interfaces by accident.&#xD;</p>

<p>It is sometimes quite hard to tell the type of parameter, from just&#xD;
looking how it is used. For example consider:&#xD;</p>

<div class="highlight"><pre> <span class="k">class</span> <span class="nc">HarderInference</span>
 <span class="p">{</span>
   <span class="k">static</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">:</span> <span class="kt">int</span> <span class="p">{</span>
     <span class="k">def</span> <span class="nf">f</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">x</span><span class="p">.</span><span class="n">Length</span>
     <span class="p">};</span>
     <span class="n">f</span> <span class="p">(</span><span class="s">"foo"</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre>
</div>


<p>When compiling the f method we cannot tell if x is a string or array&#xD;
or something else. Nevertheless, we can tell it later (looking at the invocation of f) and Nemerle type inference engine does it.&#xD;</p>

<p>If a function with incomplete type information is not used or its type&#xD;
is ambiguous, the compiler will refuse to compile it.&#xD;</p>

<h2><span class="mw-headline" id="More_info"><a name="More_info" id="More_info">More info</a></span></h2>

<p>Now, once you read through all this, please move to the <a class="internal present" href="/Grokking-Nemerle.html">Grokking Nemerle</a>&#xD;
tutorial, that is much more complete. You can also have a look at &#xD;</p>

<p><a class="internal absent" href="/The-Reference-Manual.html">Reference</a> if you are tough.&#xD;</p>

                                </div>
                        </td>
                        <td width="100px">
                            &nbsp;
                        </td>
                    </tr>
                </tbody></table>
            </td>
        </tr>
            <tr class="footer">
                <td>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody><tr>
                            <td colspan="2">
                                &nbsp;&nbsp;© 2011 <a href="http://code.google.com/p/nemerle/people/list">Nemerle Project Team</a>&nbsp;&nbsp;This site is hosted and maintained by <a href="http://rsdn.ru/">Russian Software Development Network</a> team
                            </td>
                            <td width="100px" align="right">
                                <a href="http://www.opensource.org/licenses/bsd-license.php">Legal&nbsp;statements</a>&nbsp;&nbsp;
                            </td>
                        </tr>
                    </tbody></table>
                </td>
            </tr>
            <tr class="shadow">
                <td>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody><tr>
                            <td width="100px"></td>
                            <td class="shadow">
                                <img src="./static/shadow-foreground.png">
                            </td>
                            <td width="100px"></td>
                        </tr>
                    </tbody></table>
                </td>
            </tr>
        </tbody></table>
</body></html>